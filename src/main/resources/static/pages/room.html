<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <link rel="stylesheet" type="text/css" href="../css/login.css"/>
  <link rel="stylesheet" href="../plugins/elementui/index.css">
  <link rel="stylesheet" href="../plugins/font-awesome/css/font-awesome.min.css">
  <script type="text/javascript" src="../js/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue"></script>
  <script src="../plugins/elementui/index.js"></script>
  <script src="../js/axios-0.18.0.js"></script>
</head>
<body>
  <div align="center" style="width: 80%; height:100%; margin: 0 auto; overflow:auto" id="firstVue">
    <h2>游戏大厅</h2>
    <template v-for='(item,index) in imgs' v-if='index%2==0'>
            <tr>
              <td>
                <img :src="item.url">
                </br>
                <button  :roomId="item.roomId" @click="joinRoom(item.roomId)"  v-show="item.manNum < 4">加入房间{{index+1}}</button>
                <button  :roomId="item.roomId" @click="joinRoom(item.roomId)" disabled="disabled" v-show="item.manNum >= 4">房间{{index+1}}人员已满</button>
              </td>
              <td v-if='index+1<imgs.length'>
                <img :src="imgs[index+1].url"></br>
                <button :roomId="imgs[index+1].roomId" @click="joinRoom(imgs[index+1].roomId)" v-show="item.manNum < 4">加入房间{{index+2}}</button>
                <button :roomId="imgs[index+1].roomId" @click="joinRoom(imgs[index+1].roomId)" disabled="disabled" v-show="item.manNum >= 4">房间{{index+2}}人员已满</button>
              </td>
            </tr>
    </template>
    <button @click="creatRoom()"> 创建房间</button>
  </div>
</body>
<script type="text/javascript">
  var myVue = new Vue({
    backend_url:"http://localhost:8888",
    el: "#firstVue",
    data: {
      //imgName: "../img/full.png"
      imgs: [
          {url: "",
            roomId:"",
          manNum:0}
      ],
      userName:"",
      timer:""
    },
    created:function () {
      this.getUserName();
      this.init();
      this.timer = setInterval(this.init, 3000);
    },
    beforeDestroy() {
      clearInterval(this.timer);
    },
    methods:{
      creatRoom(){
        axios.get("/api/goods/room/createRoom").then((response)=>{
          if (response.data.code == 'SUCCESS') {
            this.joinRoom(response.data.roomId)
            location.href="wait.html?roomId="+response.data.roomId+"&userName="+this.userName
          }
        })
      },
      joinRoom(data){
        axios.get("/api/goods/user/"+this.userName+"/"+data+"/enterRoom").then((response) =>{
          if (response.data.code == 'SUCCESS') {
             location.href="wait.html?roomId="+data+"&userName="+this.userName
          }
        })
      },
      getUserName(){
        var url = location.search //获取url中"?"符后的字串 ('?modFlag=business&role=1')
        var theRequest = new Object()
        if (url.indexOf('?') != -1) {
          var str = url.substr(1) //substr()方法返回从参数值开始到结束的字符串；
          var strs = str.split('&')
          for (var i = 0; i < strs.length; i++) {
            theRequest[strs[i].split('=')[0]] = strs[i].split('=')[1]
          }
          this.userName = theRequest.userName
        }
      },
      init(){
        axios.get("/api/goods/room/getHallInfo").then((response) => {
          console.log(response.data);
         if(response.data.code == 'SUCCESS'){
           this.imgs = []
           for (let item of response.data.resMap) {
             var img = {url:"",roomId:"",manNum:0}
             if (item.manNum == 0){
               img.url = '../img/isNoLogin.png'
             }else if(item.manNum == 1){
                  img.url = '../img/haveOneMan.png'
                }else if (item.manNum == 2) {
                  img.url = '../img/haveTwoMan.png'
                }else if (item.manNum == 3) {
                  img.url = '../img/haveThreeMan.png'
                }else {
                  img.url = '../img/full.png'
                }
             img.roomId = item.roomNum
             img.manNum=item.manNum
             if (img.url != '' && img.roomId != ''){
               this.imgs.push(img)
             }
           }
         }
      });
        console.log(11)
      }

    }
  })
</script>
</html>